{% extends 'base.html' %}

{% block title %}Profile {% endblock %}

{% block content %}

{% if request.user.is_authenticated %}
<div class="row">
    <div class="col">
        <h3 class="mt-3">
            {{ request.user|capfirst }}'s Profile {% if verified is True %}<i class="fas fa-check-circle fa-xs text-primary"></i>{% endif %}
        </h3>
    </div>
</div>
<div class="row">
    <div class="col">
        <div class="card mb-3">
            <div class="card-body">
                <div class="row">
                    <div class="col-3">
                        {% if avatar %}
                            <!--Render avatar photo here-->
                        {% else %}
                            <i class="fas fa-7x fa-user-circle"></i>
                        {% endif %}
                    </div>
                    <div class="col-9">
                        <h4>Manage Profile</h4>
                        <h5>Store: {{ request.user.userprofile.store_name }}</h5>
                        <button class="button btn btn-primary btn-sm">Change Avatar Photo</button>
                        <button class="button btn btn-primary btn-sm">View Seller Profile</button>
                        <button class="button btn btn-danger btn-sm">Delete Account</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <h4>Default Shipping Details</h4>
                        <!--Shipping info table here -->
                        <button class="button btn btn-primary">Edit Shipping Details</button>
                    </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col">
        <div class="card">
            <div class="card-body">
                <h4>Purchase History</h4>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <th scope="col">Order Number</th>
                            <th scope="col">Order Date</th>
                            <th scope="col">Order Items</th>
                            <th scope="col">Order Total</th>
                        </thead>
                        <tbody>
                            {% for order in orders %}
                            <tr>
                                <td scope="row"><a href="{% url 'checkout:order_history' order.order_num %}">{{ order.order_num|truncatechars:7 }}</a></td>
                                <td scope="row">{{ order.order_date|date:"SHORT_DATE_FORMAT" }}</td>
                                <td scope="row">
                                    <ul class="list-unstyled">
                                    {% for line_item in order.items.all %}
                                        <li class="small">
                                            {{ line_item.item.product_name }} x {{ line_item.quantity }}
                                        </li>
                                    {% endfor %}
                                    </ul>
                                </td>
                                <td scope="row">${{ order.get_grand_total }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
    <h3> TEST - NOT LOGGED IN </h3>
{% endif %}

{% endblock %}